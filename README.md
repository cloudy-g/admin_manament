## React 后台项目开发

#### 1. git 创建仓库

- 使用

```js
create-react-app admin_management // 脚手架 创建 文件
git commit -m "first commit"
git branch -M master
git remote add origin git@github.com:cloudy-g/admin_manament.git
git push -u origin master
```

- 分支操作

```js
git checkout -b dev // 创建并切换到 dev 分支
git checkout dev // 切换分支
git pull origin dev // 拉取 origin的master分支 并合并到 dev分支

git checkout master
git merge dev // 合并前要先切回要并入的分支,然后合并dev分支的内容到 master 上 

git push -u origin master // 将master推送到 origin远程仓库
```

#### 2. Antd

- 4.x版本默认支持 tree-shaking 按需加载，无需配置
- 3.x版本根据官网配置按需加载文件

#### 3. npm 命令

- 下载的包使用 `npm install`命令 

#### 4. 脚手架配置文件修改

```js
npm i react-app-rewired customize-cra -D
// 添加文件 config-overrides.js
// 修改 package.json文件
```

#### 5. Login页面 

- 路由设置 /login
- 页面开发
  - 样式重置 reset.css https://github.com/filipelinhares/ress/blob/master/ress.css
- 主要两个功能
  - 1. 获取用户名和密码进行标准性验证
       - 用户名4-12位
       - 密码4-8位，
       - 都只允许包含字母，数字，下划线
  - 2. 验证无误后传给后台，进行验证用户名和密码正确性
       - 验证成功 ->>  返回用户相关数据，进行路由跳转
       - 验证失败 ->>  提示用户信息
- 几个点
  - 用户验证时以及验证成功的提示信息，使用 `useReducer`hook实现
  - 设置1s后进行路由跳转，使用`replace`方法，并在`useEffect`中进行定时器清除工作
  - 用户信息使用`localStorage`进行存储
  - 表单使用`antd`的样式
- 逻辑注意点（根据b站账号登录页自动填充功能）
  - 登录页面的账户信息存储在`localStorage`里面，若是在当前已经登录的登录页刷新，则自动填充账号信息
- 登录页大致完成

#### 6. Admin 页面

- 登录页跳转到路由'/'，转到'/admin'路由页，自动重定向到'/home'界面，保持Tab框选中

- 使用编程式导航的方式，点击侧边栏实现路由跳转，加载对应的组件
- 整体布局搭建完成，主要包括侧边栏，顶部通栏，对应Tab栏的标题和日期显示

- 库
  - `antd`的布局组件，加载中组件以及若干图标
  - 格式化日期 https://github.com/date-fns/date-fns

- 几个注意点
  - 当使用url直接访问某个路径，会判断当前用户是否已经登录，若登陆则允许进行不登录则会自动返回到登录页面
  - 在当前页刷新的时候，保持用户数据不会丢失，以及当前页面的信息不会因为刷新而有所改变，可以使用路由作为标志
- 对当前组件进行拆分
  - 侧边栏`leftSider`
  - 主要内容区`contentMain`

#### 7. Home 首页

- 简单完成

#### 8. category 品类管理页

- 使用`Card`布局，`Table Modal `和分页技术
- 保持表格的数据源唯一，就可以达到动态切换显示数据的目的
- 总数据进行缓存处理
- 一级菜单列表和二级菜单列表进行切换
- 修改当前分类名称
- 进入当前分类的子分类
  - 修改子分类之后要求数据统一，通过改变缓存的整体数据达到统一
- 使用`axios get`获取后台数据，使用`post`将整体修改完成的数据进行统一提交
- 输入框自动获取焦点
- 使用一个标记用于记录当前在一类还是二类菜单列表，用以管理*查看子分类*是否显示

#### 9. Product 商品管理页

- `Card`布局，关键字搜索，二级路由设置，后台数据处理	
  - 主页
    - 缓存当前获取的产品数据
    - 关键字搜索，使用变量记录关键字类型，并记录当前的关键字，点击进行筛选
    - 重置按钮置当前关键字为空，根据缓存数据进行更新`Table`数据源
    - 状态的改变，通过控制产品的`status`进行控制
    - 修改，及详情，添加商品按钮风格同品类管理页面
  - 详情页
    - 返回前一步按钮
    - 根据`url`上的动态传值，使用`params`传递产品的特殊参数，这里使用`pid`，获取详细的产品信息进行填充页面
  - 添加商品页面
    - 返回按钮
    - `Form`表单，设置排版以及各式
    - 分类设置根据当前最新数据生成`options`
    - 商品名称，店铺名称，商品价格，商品分类
    - 商品图片，使用`Upload`组件，上传的图片上传到后台，并返回访问这个图片所需要的地址信息，并设置当前要添加商品的图片信息的地址
    - 提交按钮，对数据进行整合验证，发送给后台
  - 修改商品页面
    - 主要逻辑与添加商品页面大致相同
    - 有以下不同
      1. 初始需要设置表单内的初始值，这里的根据`url`上的动态参数进行获取产品信息进行填充，这里填充表单数据不能在`render`函数中或者函数式组件直接进行修改，因为此时的页面会重新渲染，一定要保证`render`或者函数式组件直接控制权为一个纯函数，类似的渲染操作，初始化操作放在声明周期钩子或者`useEffect`中或其他`Hooks`中
      2. 图片路径进行简单处理

#### 10. Charactor 角色管理页面

- 类似的`Card`布局，单选框的使用，修改与删除角色的类似功能，分页，创建角色以及权限管理
  - 缓存总数据，保证总数据与后台的同步
  - 修改角色类似于品类管理
  - 删除角色获取当前行的产品信息，进行删除
  - 时间格式化
  - 点击当前行，设置权限按钮的禁用状态
  - 使用`Tree`结构进行布局，获取当前点击产品的信息，对`checkedKeys`进行设置，使用数据的`menus`初始化，点击确认后进行提交

#### 11. User 用户管理

- 布局等

  - 添加用户，删除用户

  - 修改用户

#### 12. redux

- 状态管理
  - 导航栏信息使用
    - 兄弟组件的共同状态进行状态提升到父组件
    - 使用redux进行管理
  - 用户登录进行管理用户状态

#### 13. 打包

- 1. 打包之后的文件可以使用`serve`插件类似服务器端运行

- 2. 使用`nginx`中间代理运行，有跨域，中间代理处理

- 3. 将文件放在后端文件目录中，没有跨域问题

     需要处理`BrowserRouter`的路由问题，刷新出现，404问题，因为此时在后端服务器上，会去寻找对应的路由，但是没有处理，所以会出现问题。

     ​	解决办法，配置中间件将所有不匹配的路由进行转发

     打包后的图片路径，原本使用的是代理，现在根据原有路径找不到资源

     ​	配置中间件，使用重定向到真正资源地址

## 随记

- `setState`的同步异步更新
  - 在`react`相关的回调中异步执行，包括生命钩子，`react`的事件监听函数(`react`的合成事件)
  - 在类似定时器，`promise`和原生事件监听中同步执行，这个同步执行包括同步进行`render`函数的调用

- 图片资源的引入使用文件的引入方式，地址使用变量嵌入
- 保证render函数或者函数式组件的纯净，不要再其内部进行渲染页面的操作，或者改变状态的操作
- 函数式组件 + hooks 的开发确实简洁
- 用到的hooks有，`useState`最多，`useEffect`次之，`useHistory`，`useLoations`，`useRouteMatch`和`useParams`在路由组件中使用较多，`useRef`，`useContext`也有，`useReducer`用于管理登录的消息提示，`useCallback`也有使用，
- 路由懒加载`Suspense`组件，`lazy`函数
- 路由动态传递参数，使用`params`传参
- 高阶组件使用，`connect`，
- 根据当前路由进行选择，`Tab`栏选中，已经当前页面`title`设置
- 缓存数据，将后台数据缓存一份，更改的时候保持前后台数据更改一致，这份总数据可以很快速的，不用在别的页面再进行发起请求，可以直接使用组件通信传递
- 文本框自动聚焦，以及文本框的共用问题，保证进入之前，以及离开之后的文本框内容的一致性
- 所有的请求根据封装的`axios`进行调用，
- 工具函数库，包括不仅限于格式化日期，格式化`url`，数据转换，自定义的`reducer`，等等